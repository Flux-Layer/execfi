"use client";

import { useState } from "react";
import { usePrivy } from "@privy-io/react-auth";
import { MalwareAlert, MalwareModal } from "./MalwareAlert";
import { MalwareQuestView } from "./MalwareQuestView";

/**
 * Check if today is Sunday (UTC timezone)
 */
function isSunday(): boolean {
  const now = new Date();
  return now.getUTCDay() === 0; // 0 = Sunday in UTC
}

export function MalwareIntegration() {
  const { authenticated } = usePrivy();
  const [isModalOpen, setIsModalOpen] = useState(false);

  // Don't show malware UI if user is not authenticated
  if (!authenticated) {
    return null;
  }

  // Only show on Sundays (UTC)
  if (!isSunday()) {
    return null;
  }

  return (
    <>
      {/* Floating alert button */}
      <MalwareAlert onOpenQuests={() => setIsModalOpen(true)} />

      {/* Fullscreen modal */}
      <MalwareModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)}>
        <MalwareQuestView />
      </MalwareModal>
    </>
  );
}
